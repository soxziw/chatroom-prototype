<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>用户登录</title>
        <script type="text/javascript"src="./js/jquery-3.6.0.min.js"></script>
    </head>
    <body>
        账    号：<input type="text" id="userID" name="userID"><span id="checkID">请输入手机号</span><br>
        密　  码：<input type="password" id="userPassword" name="userPassword"><br>
        验 证 码：<input type="text" id="checkWord" name="checkWord" maxlength="4"> <a id="check" name="check" class="check"></a><br>
        <button id="btnOK">确定</button> <a href="../static/userRegister.html">注册</a>
        <script type="text/javascript">
            $("#userID").keyup(function(e){
                if  (e.keyCode == 13) {
                    var num = ['0','1','2','3','4','5','6','7','8','9']
                    // 从input等输入组件取得数据，用val()，其他元素用html()
                    // if (inputData.length==0)return false;
                    var inputData = $(this).val();
                    if (inputData.length != 11) {
                        $("#checkID")[0].style.color = 'red';
                        return;
                    }
                    for (var i = 0; i < 11; i = i + 1) {
                        if (num.indexOf(inputData[i]) == -1) {
                            $("#checkID")[0].style.color = 'red';
                            return;
                        }
                    }
                    $("#checkID")[0].style.color = 'green';
                    $("#userPassword").focus();//获得焦点
                }
            });
            $("#userPassword").keyup(function(e){
                if(e.keyCode==13)$("#checkWord").focus();
            });
            $("#checkWord").keyup(function(e){
                if(e.keyCode==13)$("#btnOK").click();
            });
            $("#btnOK").click(function(){
                var userID=$("#userID").val();
                var userPassword=$("#userPassword").val();
                var checkWord=$("#checkWord").val();
                var check= $("#check").html();
                if(checkWord!=check){
                    alert("验证码错误！");
                    location.reload();
                }
                else{
                    $.post("/login",{userID:userID,userPassword:userPassword},function(rtn){
                        if (rtn[0]) {
                            alert("登录成功！");
                            location.replace("/chatRoom");
                        } else {
                            alert("用户名或密码错误！");
                        }
                    });
                }
            });
            window.onload=function(){
                var word="";
                var key=['0','1','2','3','4','5','6','7','8','9',
                        'a','b','c','d','e','f','g','h','i','j',
                        'k','l','m','n','o','p','q','r','s','t',
                        'u','v','w','x','y','z','A','B','C','D',
                        'E','F','G','H','I','J','K','L','M','N',
                        'O','P','Q','R','S','T','U','V','W','X',
                        'Y','Z']
                for(var i=0;i<4;i=i+1){
                    var result=Math.floor(Math.random()*(62));
                    word=word+key[result];
                }
                $("#check").html(word);
            }
        </script>
    </body>
</html>
